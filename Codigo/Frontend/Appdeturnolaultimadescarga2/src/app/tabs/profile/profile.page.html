<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Mi Perfil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="profile-container">
  <div class="profile-wrapper">
    <div class="profile-card">

      <div class="profile-header">
        <h2> Informaci贸n Personal</h2>
        <p *ngIf="!editarActivo" class="subtitle">Visualiza y edita tus datos</p>
        <p *ngIf="editarActivo" class="subtitle edit-mode">锔 Modo edici贸n activo</p>
      </div>

      <div class="avatar-section">
        <div class="avatar-wrapper" (click)="editarActivo && toggleAvatarMenu()">
          <img [src]="selectedAvatarPath" alt="Avatar" class="avatar-img" />
          <ion-icon *ngIf="editarActivo" name="camera" class="camera-icon"></ion-icon>
        </div>

        <div class="avatar-menu" *ngIf="showAvatarMenu && editarActivo">
          <div
            *ngFor="let avatar of avatars"
            class="avatar-option"
            (click)="selectAvatar(avatar)"
          >
            <img [src]="avatar.path" [alt]="avatar.name" />
          </div>
        </div>
      </div>

      <div class="profile-info">
        <ion-item lines="none">
          <ion-icon name="person" slot="start"></ion-icon>
          <ion-label position="stacked">Nombre de Usuario</ion-label>
          <ion-input
            [(ngModel)]="nombre_usuario"
            [readonly]="!editarActivo"
            placeholder="Tu nombre de usuario"
          ></ion-input>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="mail" slot="start"></ion-icon>
          <ion-label position="stacked">Email</ion-label>
          <ion-input [(ngModel)]="email" readonly></ion-input>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="card" slot="start"></ion-icon>
          <ion-label position="stacked">DNI</ion-label>
          <ion-input
            [(ngModel)]="dni"
            [readonly]="!editarActivo"
            type="number"
            maxlength="8"
            pattern="[0-9]*"
            placeholder="Solo n煤meros (sin puntos)"
          ></ion-input>
          <ion-note color="danger" *ngIf="dniError && editarActivo">
            锔 El DNI debe tener 7 u 8 n煤meros sin puntos
          </ion-note>
        </ion-item>

        <ion-item lines="none">
          <ion-icon name="location" slot="start"></ion-icon>
          <ion-label position="stacked">Ubicaci贸n</ion-label>
          <ion-input
            [(ngModel)]="ubicacion"
            [readonly]="!editarActivo"
            placeholder="Ciudad o zona"
          ></ion-input>
        </ion-item>

        <!-- Toggle de Dark Mode -->
        <ion-item lines="none">
          <ion-icon name="moon" slot="start"></ion-icon>
          <ion-label>Modo Oscuro</ion-label>
          <ion-toggle 
            [checked]="themeService.isDarkMode()" 
            (ionChange)="themeService.toggleDarkMode()"
          ></ion-toggle>
        </ion-item>
      </div>

      <div class="button-group">
        <ion-button
          *ngIf="!editarActivo"
          expand="block"
          (click)="editarPerfil()"
          class="btn-editar"
        >
          Editar Perfil
        </ion-button>

        <div *ngIf="editarActivo" class="edit-buttons">
          <ion-button class="btn-guardar" (click)="guardarCambios()">Guardar</ion-button>
          <ion-button class="btn-cancelar" (click)="cancelarEdicion()">Cancelar</ion-button>
        </div>

        <ion-button
          expand="block"
          (click)="logout()"
          class="btn-cerrar"
        >
          Cerrar Sesi贸n
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
