<ion-content class="profile-container">
  <div class="profile-wrapper">
    <div class="profile-card">
      <div class="profile-header">
        <h2>Mi Perfil</h2>
      </div>

      <div class="avatar-section">
        <div class="avatar-wrapper" (click)="editarActivo && toggleAvatarMenu()">
          <img [src]="selectedAvatarPath" alt="Avatar" class="avatar-img" />
        </div>

        <div class="avatar-menu" *ngIf="showAvatarMenu && editarActivo">
          <div
            *ngFor="let avatar of avatars"
            class="avatar-option"
            (click)="selectAvatar(avatar)"
          >
            <img [src]="avatar.path" [alt]="avatar.name" />
          </div>
        </div>
      </div>

      <div class="profile-info">
        <ion-item lines="none">
          <ion-label position="stacked">Nombre de Usuario</ion-label>
          <ion-input
            [(ngModel)]="nombre_usuario"
            [readonly]="!editarActivo"
            placeholder="Tu nombre de usuario"
          ></ion-input>
        </ion-item>

        <ion-item lines="none">
          <ion-label position="stacked">Email</ion-label>
          <ion-input [(ngModel)]="email" readonly></ion-input>
        </ion-item>

        <ion-item lines="none">
          <ion-label position="stacked">DNI</ion-label>
          <ion-input
            [(ngModel)]="dni"
            [readonly]="!editarActivo"
            type="number"
            maxlength="8"
            pattern="[0-9]*"
            placeholder="Solo nÃºmeros (sin puntos)"
          ></ion-input>
          <ion-note color="danger" *ngIf="dniError && editarActivo">
            âš ï¸ El DNI debe tener 7 u 8 nÃºmeros sin puntos
          </ion-note>
        </ion-item>

        <ion-item lines="none">
          <ion-label position="stacked">UbicaciÃ³n</ion-label>
          <ion-input
            [(ngModel)]="ubicacion"
            [readonly]="!editarActivo"
            placeholder="Ciudad o zona"
          ></ion-input>
        </ion-item>

        <!-- ğŸ”¹ TelÃ©fono con selector de paÃ­s -->
        <ion-item lines="none">
          <ion-label position="stacked">TelÃ©fono</ion-label>
          <div class="phone-input">
            <ion-select
              [(ngModel)]="codigoPais"
              [disabled]="!editarActivo"
              interface="popover"
              class="codigo-select"
            >
              <ion-select-option value="+54">ğŸ‡¦ğŸ‡· +54 (AR)</ion-select-option>
              <ion-select-option value="+598">ğŸ‡ºğŸ‡¾ +598 (UY)</ion-select-option>
              <ion-select-option value="+56">ğŸ‡¨ğŸ‡± +56 (CL)</ion-select-option>
              <ion-select-option value="+57">ğŸ‡¨ğŸ‡´ +57 (CO)</ion-select-option>
              <ion-select-option value="+34">ğŸ‡ªğŸ‡¸ +34 (ES)</ion-select-option>
              <ion-select-option value="+1">ğŸ‡ºğŸ‡¸ +1 (US)</ion-select-option>
            </ion-select>

            <ion-input
             [(ngModel)]="telefono_local"
             [readonly]="!editarActivo"
             type="number"
             inputmode="numeric"
             pattern="[0-9]*"
             placeholder="Ej: 1133344455"
             maxlength="15"
             (ionInput)="validarSoloNumeros($event)"
            ></ion-input>
          </div>

          <ion-note color="warning" *ngIf="telefonoError && editarActivo" class="tel-note">
            âš ï¸ NÃºmero invÃ¡lido para el paÃ­s seleccionado
          </ion-note>
        </ion-item>
      </div>

      <div class="button-group">
        <ion-button
          *ngIf="!editarActivo"
          expand="block"
          (click)="editarPerfil()"
          class="btn-editar"
        >
          Editar Perfil
        </ion-button>

        <div *ngIf="editarActivo" class="edit-buttons">
          <ion-button class="btn-guardar" (click)="guardarCambios()">Guardar</ion-button>
          <ion-button class="btn-cancelar" (click)="cancelarEdicion()">Cancelar</ion-button>
        </div>

        <ion-button expand="block" (click)="logout()" class="btn-cerrar">
          Cerrar SesiÃ³n
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
